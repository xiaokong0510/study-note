(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{315:function(a,t,s){"use strict";s.r(t);var e=s(13),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"apollo入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apollo入门"}},[a._v("#")]),a._v(" Apollo入门")]),a._v(" "),t("p",[a._v("公司项目使用了Apollo配置中心，找了个入门视频学习一下。只是一些基本的操作，架构有待深入研究。内容包括：")]),a._v(" "),t("ol",[t("li",[a._v("Apollo 的工作流程")]),a._v(" "),t("li",[a._v("Apollo 的4个维度管理 Key-Value 格式的配置：\n"),t("ul",[t("li",[a._v("application (应用)")]),a._v(" "),t("li",[a._v("environment (环境)")]),a._v(" "),t("li",[a._v("cluster (集群)")]),a._v(" "),t("li",[a._v("namespace (命名空间)")])])]),a._v(" "),t("li",[a._v("WSL2下 docker 部署apollo")]),a._v(" "),t("li",[a._v("SpringBoot 集成Apollo的使用方法")])]),a._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/ctripcorp/apollo",target:"_blank",rel:"noopener noreferrer"}},[a._v("git地址"),t("OutboundLink")],1)])]),a._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/design/apollo-introduction",target:"_blank",rel:"noopener noreferrer"}},[a._v("中文文档"),t("OutboundLink")],1)])]),a._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://www.bilibili.com/video/BV1eE41187sS",target:"_blank",rel:"noopener noreferrer"}},[a._v("B站 黑马轻松入门Apollo分布式配置中心"),t("OutboundLink")],1)])]),a._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.pbteach.com/post/java_distribut/apollo_yq_doc/",target:"_blank",rel:"noopener noreferrer"}},[a._v("配套讲义"),t("OutboundLink")],1)])])]),a._v(" "),t("h2",{attrs:{id:"_1-配置和配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置和配置中心"}},[a._v("#")]),a._v(" 1. 配置和配置中心")]),a._v(" "),t("p",[a._v("配置主要有以下几个特点：")]),a._v(" "),t("ul",[t("li",[a._v("配置是独立于程序的只读变量：独立于程序的，对于程序是只读的")]),a._v(" "),t("li",[a._v("配置伴随应用的整个生命周期：启动、运行")]),a._v(" "),t("li",[a._v("配置可以有多种加载方式：程序内部硬编码，配置文件，环境变量，启动参数，基于数据库等")]),a._v(" "),t("li",[a._v("配置需要治理：权限控制、不同环境和集群配置管理")])]),a._v(" "),t("p",[a._v("微服务化的过程中，当系统从一个单体应用被拆分成分布式系统上一个个服务节点后，配置文件也必须跟着分割，这样配置就分散了。"),t("strong",[a._v("配置中心将配置从应用中剥离出来，统一管理，优雅的解决了配置的动态变更、持久化、运维成本等问题")]),a._v("。应用自身既不需要去添加管理配置接口，也不需要自己去实现配置的持久化，更不需要引入“定时任务”以便降低运维成本。 "),t("strong",[a._v("即，配置中心就是一种统一管理各种应用配置的基础服务组件。")])]),a._v(" "),t("p",[a._v("一个合格的配置中心需要满足一下几个特点：")]),a._v(" "),t("ul",[t("li",[a._v("配置项容易读取和修改")]),a._v(" "),t("li",[a._v("添加新配置简单直接")]),a._v(" "),t("li",[a._v("支持对配置的修改的检视以把控风险")]),a._v(" "),t("li",[a._v("可以查看配置修改的历史记录")]),a._v(" "),t("li",[a._v("不同部署环境支持隔离")])]),a._v(" "),t("h2",{attrs:{id:"_2-apollo入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-apollo入门"}},[a._v("#")]),a._v(" 2. Apollo入门")]),a._v(" "),t("h3",{attrs:{id:"_2-1-主流配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-主流配置中心"}},[a._v("#")]),a._v(" 2.1 主流配置中心")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("Disconf，百度")])]),a._v(" "),t("li",[t("p",[a._v("Spring Cloud Config，Spring Cloud 生态组件，可以和Spring Cloud体系无缝整合。")])]),a._v(" "),t("li",[t("p",[a._v("Apollo，携程")])]),a._v(" "),t("li",[t("p",[a._v("Nacos，阿里")])])]),a._v(" "),t("h3",{attrs:{id:"_2-2-apollo特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-apollo特性"}},[a._v("#")]),a._v(" 2.2 Apollo特性")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("统一管理不同环境、不同集群的配置")]),a._v(" "),t("ul",[t("li",[a._v("Apollo提供了一个统一界面集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。")]),a._v(" "),t("li",[a._v("同一份代码部署在不同的集群，可以有不同的配置，比如zookeeper的地址等")]),a._v(" "),t("li",[a._v("通过命名空间（namespace）可以很方便地支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖")])])]),a._v(" "),t("li",[t("strong",[a._v("配置修改实时生效（热发布）")]),a._v(" "),t("ul",[t("li",[a._v("用户在Apollo修改完配置并发布后，客户端能实时（1秒）接收到最新的配置，并通知到应用程序")])])]),a._v(" "),t("li",[t("strong",[a._v("版本发布管理")]),a._v(" "),t("ul",[t("li",[a._v("所有的配置发布都有版本概念，从而可以方便地支持配置的回滚")])])]),a._v(" "),t("li",[t("strong",[a._v("灰度发布")]),a._v(" "),t("ul",[t("li",[a._v("支持配置的灰度发布，比如点了发布后，只对部分应用实例生效，等观察一段时间没问题后再推给所有应用实例")])])]),a._v(" "),t("li",[t("strong",[a._v("权限管理、发布审核、操作审计")]),a._v(" "),t("ul",[t("li",[a._v("应用和配置的管理都有完善的权限管理机制，对配置的管理还分为了编辑和发布两个环节，从而减少人为的错误。")]),a._v(" "),t("li",[a._v("所有的操作都有审计日志，可以方便地追踪问题")])])]),a._v(" "),t("li",[t("strong",[a._v("客户端配置信息监控")]),a._v(" "),t("ul",[t("li",[a._v("可以在界面上方便地看到配置在被哪些实例使用")])])]),a._v(" "),t("li",[t("strong",[a._v("提供Java和.Net原生客户端")]),a._v(" "),t("ul",[t("li",[a._v("提供了Java和.Net的原生客户端，方便应用集成")]),a._v(" "),t("li",[a._v("支持Spring Placeholder, Annotation和Spring Boot的ConfigurationProperties，方便应用使用（需要Spring 3.1.1+）")]),a._v(" "),t("li",[a._v("同时提供了Http接口，非Java和.Net应用也可以方便地使用")])])]),a._v(" "),t("li",[t("strong",[a._v("提供开放平台API")]),a._v(" "),t("ul",[t("li",[a._v("Apollo自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。不过Apollo出于通用性考虑，不会对配置的修改做过多限制，只要符合基本的格式就能保存，不会针对不同的配置值进行针对性的校验，如数据库用户名、密码，Redis服务地址等")]),a._v(" "),t("li",[a._v("对于这类应用配置，Apollo支持应用方通过开放平台API在Apollo进行配置的修改和发布，并且具备完善的授权和权限控制")])])])]),a._v(" "),t("p",[t("strong",[a._v("Apollo的执行流程：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20200624231416294.png",alt:"image-20200624231416294"}})]),a._v(" "),t("ul",[t("li",[a._v("用户在配置中心对配置进行修改并发布")]),a._v(" "),t("li",[a._v("Apollo配置中心会向客户端推送最新的配置")]),a._v(" "),t("li",[a._v("Apollo客户端会定时从Apollo配置中心拉取最新的配置、更新本地配置并通知到应用")])]),a._v(" "),t("h3",{attrs:{id:"_2-3-快速开始"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-快速开始"}},[a._v("#")]),a._v(" 2.3 快速开始")]),a._v(" "),t("p",[a._v("Quick Start需要有bash环境，Windows用户安装Git Bash")]),a._v(" "),t("h4",{attrs:{id:"_01-环境要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-环境要求"}},[a._v("#")]),a._v(" 01 环境要求")]),a._v(" "),t("p",[a._v("Java")]),a._v(" "),t("ul",[t("li",[a._v("Apollo服务端：1.8+")]),a._v(" "),t("li",[a._v("Apollo客户端：1.7+")])]),a._v(" "),t("p",[a._v("MySQL：")]),a._v(" "),t("ul",[t("li",[a._v("版本要求：5.6.5+，Apollo的表结构对"),t("code",[a._v("timestamp")]),a._v("使用了多个default声明，所以需要5.6.5以上版本。")])]),a._v(" "),t("h4",{attrs:{id:"_02-下载quick-start安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-下载quick-start安装包"}},[a._v("#")]),a._v(" 02 下载Quick Start安装包")]),a._v(" "),t("p",[a._v("下载地址：https://github.com/nobodyiam/apollo-build-scripts")]),a._v(" "),t("ol",[t("li",[a._v("apollo-configservice")]),a._v(" "),t("li",[a._v("apollo-adminservice")]),a._v(" "),t("li",[a._v("apollo-portal")])]),a._v(" "),t("h4",{attrs:{id:"_03-创建数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-创建数据库"}},[a._v("#")]),a._v(" 03 创建数据库")]),a._v(" "),t("p",[a._v("Apollo服务端共需要两个数据库："),t("code",[a._v("ApolloPortalDB")]),a._v(" 和"),t("code",[a._v("ApolloConfigDB")]),a._v("，ApolloPortalDB 只需要在生产环境部署一个即可，"),t("strong",[a._v("而ApolloConfigDB 需要在每个环境部署一套。")])]),a._v(" "),t("p",[t("strong",[a._v("ApolloPortalDB")]),a._v("：")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/apolloconfig/apollo-build-scripts/blob/master/sql/apolloportaldb.sql",target:"_blank",rel:"noopener noreferrer"}},[a._v("apolloportaldb.sql"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("导入apolloportaldb.sql成功后，可以通过执行以下sql语句来验证：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select `Id`, `AppId`, `Name` from ApolloPortalDB.App;\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[a._v("Id")]),a._v(" "),t("th",[a._v("AppId")]),a._v(" "),t("th",[a._v("Name")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("1")]),a._v(" "),t("td",[a._v("SampleApp")]),a._v(" "),t("td",[a._v("Sample App")])])])]),a._v(" "),t("p",[t("strong",[a._v("ApolloConfigDB")]),a._v("：")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/apolloconfig/apollo-build-scripts/blob/master/sql/apolloconfigdb.sql",target:"_blank",rel:"noopener noreferrer"}},[a._v("apolloconfigdb.sql"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("导入apolloconfigdb.sql 成功后，可以通过执行以下sql语句来验证：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select `NamespaceId`, `Key`, `Value`, `Comment` from ApolloConfigDB.Item;\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[a._v("NamespaceId")]),a._v(" "),t("th",[a._v("Key")]),a._v(" "),t("th",[a._v("Value")]),a._v(" "),t("th",[a._v("Comment")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("1")]),a._v(" "),t("td",[a._v("timeout")]),a._v(" "),t("td",[a._v("100")]),a._v(" "),t("td",[a._v("sample timeout配置")])])])]),a._v(" "),t("h4",{attrs:{id:"_04-配置数据库连接信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-配置数据库连接信息"}},[a._v("#")]),a._v(" 04 配置数据库连接信息")]),a._v(" "),t("p",[a._v("编辑 "),t("a",{attrs:{href:"https://github.com/nobodyiam/apollo-build-scripts/blob/master/demo.sh",target:"_blank",rel:"noopener noreferrer"}},[a._v("demo.sh"),t("OutboundLink")],1),a._v("，修改 ApolloPortalDB 和 ApolloConfigDB 相关的数据库连接信息。")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apollo config db info")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_config_db_url")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("jdbc:mysql://localhost:3306/ApolloConfigDB?characterEncoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf8\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_config_db_username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("username\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_config_db_password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("password\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apollo portal db info")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_portal_db_url")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("jdbc:mysql://localhost:3306/ApolloPortalDB?characterEncoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("utf8\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_portal_db_username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("username\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("apollo_portal_db_password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("password\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("h4",{attrs:{id:"_05-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-启动"}},[a._v("#")]),a._v(" 05 启动")]),a._v(" "),t("p",[a._v("Apollo默认会启动3个服务，分别使用8070, 8080, 8090端口，确保这3个端口当前没有被使用。执行启动命令：")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./demo.sh start\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("ol",[t("li",[a._v("apollo-configservice  8080")]),a._v(" "),t("li",[a._v("apollo-adminservice  8090")]),a._v(" "),t("li",[a._v("apollo-portal  8070")])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20200627112616194.png",alt:"image-20200627112616194"}})]),a._v(" "),t("p",[a._v("启动成功后，通过 http://localhost:8070 就可以访问，登录名/密码：  apollo/admin")]),a._v(" "),t("p",[a._v("SampleApp进入配置界面，可以看到当前有一个配置 timeout=100。")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20200627113400493.png",alt:"image-20200627113400493"}})]),a._v(" "),t("h4",{attrs:{id:"_06-运行客户端程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_06-运行客户端程序"}},[a._v("#")]),a._v(" 06 运行客户端程序")]),a._v(" "),t("p",[a._v("启动Demo客户端：")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./demo.sh client\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("输入"),t("code",[a._v("timeout")]),a._v("，就可以取到对应配置的值：")]),a._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("sh"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("timeout")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("SimpleApolloConfigDemo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" Loading key "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("timeout")]),a._v(" with value: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20200627113144308.png",alt:"image-20200627113144308"}})]),a._v(" "),t("h3",{attrs:{id:"_2-4-docker方式部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-docker方式部署"}},[a._v("#")]),a._v(" 2.4 Docker方式部署")]),a._v(" "),t("p",[a._v("我本机环境是 Win10，安装了 WSL2，Docker 可以直接跑在里面，以此为环境。")]),a._v(" "),t("p",[a._v("文档可参考："),t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows/wsl/install-win10",target:"_blank",rel:"noopener noreferrer"}},[a._v("WSL2官方安装教程"),t("OutboundLink")],1)]),a._v(" "),t("h4",{attrs:{id:"_01-数据库准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-数据库准备"}},[a._v("#")]),a._v(" 01 数据库准备")]),a._v(" "),t("p",[a._v("Docker 部署mysql，可参考之前的博客 "),t("a",{attrs:{href:"http://www.kongxiao.top/archives/docker-baseuse",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker基本操作"),t("OutboundLink")],1)]),a._v(" "),t("blockquote",[t("p",[a._v("需要注意的是，要使用 ifconfig 查看 WSL的 ip地址。")]),a._v(" "),t("p",[a._v("主机也可以用 localhost 连接上 WSL2，但是 WSL2 内部使用 localhost 连不上自己，因此后面的数据库 ip  都使用了下面的ip。(貌似重启这个ip会改变)")])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20210716142200559.png",alt:"image-20210716142200559"}})]),a._v(" "),t("h4",{attrs:{id:"_02-apollo-config-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-apollo-config-service"}},[a._v("#")]),a._v(" 02  Apollo Config Service")]),a._v(" "),t("ul",[t("li",[t("p",[t("strong",[a._v("apollo-configservice 本身就是一个 eureka 服务")])])]),a._v(" "),t("li",[t("p",[a._v("apollo-configservice 、 apollo-adminservice 都需要向 eureka 服务注册")])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("配置项统一存储在 ApolloConfigDB.ServerConfig 表中，其中 eureka.service.url 表示 eureka 服务地址")])])])]),a._v(" "),t("p",[a._v("获取镜像")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull apolloconfig/apollo-configservice:1.7.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("运行镜像")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SPRING_DATASOURCE_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"jdbc:mysql://172.26.100.204:3306/ApolloConfigDB?characterEncoding=utf8"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SPRING_DATASOURCE_USERNAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SPRING_DATASOURCE_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -d -v /tmp/logs:/opt/logs --name apollo-configservice apolloconfig/apollo-configservice:1.7.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("参数说明：")]),a._v(" "),t("ul",[t("li",[a._v("SPRING_DATASOURCE_URL: 对应环境ApolloConfigDB的地址")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_USERNAME: 对应环境ApolloConfigDB的用户名")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_PASSWORD: 对应环境ApolloConfigDB的密码")])]),a._v(" "),t("h4",{attrs:{id:"_03-apollo-admin-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-apollo-admin-service"}},[a._v("#")]),a._v(" 03 Apollo Admin Service")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("配置项统一存储在 ApolloConfigDB.ServerConfig 表中，其中 eureka.service.url 表示 eureka 服务地址")]),a._v("，即 apollo-configservice 的地址")]),a._v(" "),t("li",[a._v("这里需要修改为 01 步中提到的 ip地址，否则服务注册不上，是个坑")])]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20210716144817807.png",alt:"image-20210716144817807"}})]),a._v(" "),t("p",[a._v("获取镜像")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker pull apolloconfig/apollo-adminservice:1.7.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("运行镜像")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('docker run -p 8090:8090 \\\n    -e SPRING_DATASOURCE_URL="jdbc:mysql://172.26.100.204:3306/ApolloConfigDB?characterEncoding=utf8" \\\n    -e SPRING_DATASOURCE_USERNAME=root -e SPRING_DATASOURCE_PASSWORD=123456 \\\n    -d -v /tmp/logs:/opt/logs --name apollo-adminservice apolloconfig/apollo-adminservice:1.7.0\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("参数说明：")]),a._v(" "),t("ul",[t("li",[a._v("SPRING_DATASOURCE_URL: 对应环境ApolloConfigDB的地址")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_USERNAME: 对应环境ApolloConfigDB的用户名")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_PASSWORD: 对应环境ApolloConfigDB的密码")])]),a._v(" "),t("h4",{attrs:{id:"_04-apollo-portal"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-apollo-portal"}},[a._v("#")]),a._v(" 04 Apollo Portal")]),a._v(" "),t("p",[a._v("获取镜像")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker pull apolloconfig/apollo-portal:1.7.0\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("运行镜像")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('docker run -p 8070:8070 \\\n    -e SPRING_DATASOURCE_URL="jdbc:mysql://172.26.100.204:3306/ApolloPortalDB?characterEncoding=utf8" \\\n    -e SPRING_DATASOURCE_USERNAME=root -e SPRING_DATASOURCE_PASSWORD=123456 \\\n    -e APOLLO_PORTAL_ENVS=dev \\\n    -e DEV_META=http://172.26.100.204:8080 \\\n    -d -v /tmp/logs:/opt/logs --name apollo-portal apolloconfig/apollo-portal:1.7.0\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("参数说明：")]),a._v(" "),t("ul",[t("li",[a._v("SPRING_DATASOURCE_URL: 对应环境 ApolloPortalDB 的地址")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_USERNAME: 对应环境 ApolloPortalDB 的用户名")]),a._v(" "),t("li",[a._v("SPRING_DATASOURCE_PASSWORD: 对应环境 ApolloPortalDB 的密码")]),a._v(" "),t("li",[a._v("APOLLO_PORTAL_ENVS(可选): 对应 ApolloPortalDB 中的 apollo.portal.envs 配置项，如果没有在数据库中配置的话，可以通过此环境参数配置")]),a._v(" "),t("li",[a._v("DEV_META/PRO_META(可选): 配置对应环境的 Meta Service 地址，以${ENV}_META命名，需要注意的是如果配置了 ApolloPortalDB 中的apollo.portal.meta.servers 配置，则以 apollo.portal.meta.servers 中的配置为准")])]),a._v(" "),t("h4",{attrs:{id:"_05-配置多环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-配置多环境"}},[a._v("#")]),a._v(" 05 配置多环境")]),a._v(" "),t("blockquote",[t("p",[a._v("一套Portal可以管理多个环境，但是每个环境都需要独立部署一套Config Service、Admin Service和ApolloConfigDB")])]),a._v(" "),t("p",[a._v("因此需要新建一张表 ApolloConfigDB_pro 保存 pro 环境的信息，并再起一套Config Service、Admin Service")]),a._v(" "),t("p",[a._v("ApolloConfigDB_pro 表中的  eureka.service.url  也需要做相应的修改")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20210716163808379.png",alt:"image-20210716163808379"}})]),a._v(" "),t("h3",{attrs:{id:"_2-5-核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-核心概念"}},[a._v("#")]),a._v(" 2.5 核心概念")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("application (应用)")]),a._v(" "),t("p",[a._v("就是实际使用配置的应用，"),t("strong",[a._v("每个应用都需要有唯一的身份标识 -- AppId")]),a._v("，要使用相应的配置时，需要在代码中指定AppId")])]),a._v(" "),t("li",[t("p",[a._v("environment (环境)")]),a._v(" "),t("p",[a._v("配置对应的环境，比如生产环境、开发环境等。环境和代码无关，同一份代码部署在不同的环境就应该能够获取到不同环境的配置")])]),a._v(" "),t("li",[t("p",[a._v("cluster (集群)")]),a._v(" "),t("p",[a._v("一个应用下不同实例的分组，比如典型的可以按照数据中心分，把上海机房的应用实例分为一个集群，把北京机房的应用实例分为另一个集群。对不同的cluster，同一个配置可以有不一样的值，即进行值覆盖。")])]),a._v(" "),t("li",[t("p",[a._v("namespace (命名空间)")]),a._v(" "),t("p",[a._v("一个应用下不同配置的分组，可以简单地把namespace类比为文件，不同类型的配置存放在不同的文件中，如数据库配置文件等。分为public和private，public可以被其他应用关联，private只能被所属的应用获取到")])])]),a._v(" "),t("h2",{attrs:{id:"_3-java客户端使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-java客户端使用"}},[a._v("#")]),a._v(" 3. Java客户端使用")]),a._v(" "),t("h3",{attrs:{id:"_3-1-发布配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-发布配置"}},[a._v("#")]),a._v(" 3.1 发布配置")]),a._v(" "),t("p",[a._v("新建项目，指定"),t("strong",[a._v("唯一的身份标识 -- AppId")]),a._v("后，可以进行配置发布。支持的单个key-value形式输入，也可以直接使用文本模式批量添加、修改。")]),a._v(" "),t("p",[a._v("新增或者修改配置后，都需要点击发布才能生效。")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20210716174942416.png",alt:"image-20210716174942416"}})]),a._v(" "),t("h3",{attrs:{id:"_3-2-springboot集成方式获取配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-springboot集成方式获取配置"}},[a._v("#")]),a._v(" 3.2 SpringBoot集成方式获取配置")]),a._v(" "),t("p",[a._v("架构图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.kongxiao.top/image-20200627115949993.png",alt:"image-20200627115949993"}})]),a._v(" "),t("p",[a._v("Apollo支持应用在不同的环境有不同的配置，所以需要在运行提供给Apollo客户端当前环境的Apollo Meta Server信息。默认情况下，meta server和config service是部署在同一个JVM进程，所以meta server的地址就是config service的地址。")]),a._v(" "),t("h4",{attrs:{id:"_01-添加apollo客户端依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-添加apollo客户端依赖"}},[a._v("#")]),a._v(" 01 添加apollo客户端依赖")]),a._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.ctrip.framework.apollo"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("apollo-client"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("1.1.0"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-boot-starter-web"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("h4",{attrs:{id:"_02-指定appid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-指定appid"}},[a._v("#")]),a._v(" 02 指定AppId")]),a._v(" "),t("p",[a._v("在Spring Boot application.yml 中配置")]),a._v(" "),t("p",[a._v("application.yml：")]),a._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定appid")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apollo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("bootstrap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#将Apollo配置加载提到初始化日志系统之前")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eagerLoad")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespaces")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" application   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定命名空间")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cacheDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /tmp/apollo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("cache   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#缓存路径")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("h4",{attrs:{id:"_03-apollo-meta-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-apollo-meta-server"}},[a._v("#")]),a._v(" 03 Apollo Meta Server")]),a._v(" "),t("p",[a._v("Apollo支持应用在不同的环境有不同的配置，常用的指定方式有如下两种：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("第一种：配置VM options："),t("code",[a._v("-Denv=DEV -Dapollo_meta=http://172.26.100.204:8080")])])]),a._v(" "),t("li",[t("p",[a._v("第二种：在resources目录下新建apollo-env.properties文件，可配置多套环境，需要配合环境参数使用")]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dev.meta")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://172.26.100.204:8080")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("pro.meta")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://172.26.100.204:8081")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])])])]),a._v(" "),t("h4",{attrs:{id:"_04-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-environment"}},[a._v("#")]),a._v(" 04 Environment")]),a._v(" "),t("p",[a._v("通过 VM options 的env来指定环境："),t("code",[a._v("-Denv=DEV")])]),a._v(" "),t("p",[a._v("配合 apollo-env.properties文件可以切换不同的环境")]),a._v(" "),t("h4",{attrs:{id:"_05-本地缓存路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-本地缓存路径"}},[a._v("#")]),a._v(" 05 本地缓存路径")]),a._v(" "),t("p",[a._v("Apollo客户端会把从服务端获取到的配置在本地文件系统缓存一份，用于在遇到服务不可用，或网络不通的时候，依然能从本地恢复配置，不影响应用正常运行。本地配置文件会以下面的文件名格式放置于配置的本地缓存路径下：{appId}+{cluster}+{namespace}.properties")]),a._v(" "),t("p",[a._v("可以通过 VM options 的apollo.cacheDir指定缓存路径，")]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v(" -Dapollo.cacheDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/opt/data/apollo-config")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h4",{attrs:{id:"_06-cluster-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_06-cluster-集群"}},[a._v("#")]),a._v(" 06 Cluster（集群）")]),a._v(" "),t("p",[a._v("通过Java System Property的apollo.cluste来指定集群："),t("code",[a._v("-Dapollo.cluster=DEFAULT")])]),a._v(" "),t("h4",{attrs:{id:"_07-通过系统配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_07-通过系统配置文件"}},[a._v("#")]),a._v(" 07 通过系统配置文件")]),a._v(" "),t("p",[a._v("还可以通过配置文件来指定 "),t("code",[a._v("env=YOUR-ENVIRONMENT")])]),a._v(" "),t("ul",[t("li",[a._v("对于Mac/Linux，默认文件位置为 "),t("code",[a._v("/opt/settings/server.properties")])]),a._v(" "),t("li",[a._v("对于Windows，默认文件位置为"),t("code",[a._v("C:\\opt\\settings\\server.properties")])])]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DEV")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("apollo.meta")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://172.26.100.204:8080")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"_4-灰度发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-灰度发布"}},[a._v("#")]),a._v(" 4. 灰度发布")]),a._v(" "),t("ol",[t("li",[a._v("对于一些对程序有比较大影响的配置，可以先在一个或者多个实例生效，观察一段时间没问题后再全量发布配置。")]),a._v(" "),t("li",[a._v("对于一些需要调优的配置参数，可以通过灰度发布功能来实现A/B测试。可以在不同的机器上应用不同的配置，不断调整、测评一段时间后找出较优的配置再全量发布配置。")])]),a._v(" "),t("p",[a._v("通过创建灰度版本，可以对某些配置做灰度测试")]),a._v(" "),t("p",[a._v("灰度流程为:")]),a._v(" "),t("ol",[t("li",[a._v("创建灰度版本")]),a._v(" "),t("li",[a._v("配置灰度配置项")]),a._v(" "),t("li",[a._v("配置灰度规则。如果是私有的namespace可以按照客户端的IP进行灰度，如果是公共的namespace则可以同时按AppId和客户端的IP进行灰度")]),a._v(" "),t("li",[a._v("灰度发布\n灰度版本最终有两种结果:"),t("strong",[a._v("全量发布和放弃灰度")]),a._v(" "),t("strong",[a._v("全量发布")]),a._v(":灰度的配置合到主版本并发布，所有的客户端都会使用合并后的配置\n"),t("strong",[a._v("放弃灰度")]),a._v(":删除灰度版本，所有的客户端都会使用回主版本的配置\n注意事项:如果灰度版本已经有灰度发布过，那么修改灰度规则后，无需再次灰度发布就立即生效")])])])}),[],!1,null,null,null);t.default=r.exports}}]);